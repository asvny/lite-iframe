{"version":3,"file":"mylib.esm.js","sources":["../src/index.ts"],"sourcesContent":["interface ControllerInterface {\n  connectedCallback(): void;\n  warmUp(): void;\n  addIframe(): void;\n}\n\ninterface Adapters {\n  youtube: typeof Youtube;\n  unknown: typeof Unknown;\n}\n\ntype None = void;\ntype Maybe<T> = T | None;\n\ntype AdapterKeys = keyof Adapters;\ntype AdapterClass = typeof Youtube | typeof Unknown;\ntype Adapter = Youtube | Unknown;\n\ntype PrefetchKind = 'prefetch' | 'preload' | 'preconnect';\ntype PrefetchAs = 'image' | 'style' | 'frame' | 'iframe' | 'fetch';\n\nfunction addPrefetch(kind: PrefetchKind, url: string, as: Maybe<PrefetchAs>) {\n  const linkElem = document.createElement('link');\n  linkElem.rel = kind;\n  linkElem.href = url;\n  if (as) {\n    linkElem.as = as;\n  }\n  linkElem.crossOrigin = 'true';\n  document.head.append(linkElem);\n}\n\nclass Unknown implements ControllerInterface {\n  public preconnected: boolean;\n  private src: Maybe<string>;\n  private instance: LiteIframe;\n  private io: Maybe<IntersectionObserver>;\n\n  constructor(instance: LiteIframe, src: string) {\n    this.instance = instance;\n    this.src = src;\n    this.preconnected = false;\n\n    this.warmUp = this.warmUp.bind(this);\n    this.addIframe = this.addIframe.bind(this);\n    this.handleIntersection = this.handleIntersection.bind(this);\n\n    if ('IntersectionObserver' in window) {\n      this.io = new IntersectionObserver(this.handleIntersection);\n    } else {\n      this.handleIframe();\n    }\n  }\n\n  public connectedCallback() {\n    if (this.io) {\n      this.io.observe(this.instance);\n    }\n  }\n\n  private handleIntersection(data: any) {\n    if (data[0].isIntersecting) {\n      this.handleIframe();\n      this.cleanup();\n    }\n  }\n\n  private handleIframe() {\n    this.addIframe();\n  }\n\n  private cleanup() {\n    if (this.io) {\n      this.io.disconnect();\n    }\n  }\n\n  public warmUp() {\n    if (this.src) addPrefetch('preload', this.src, 'iframe');\n  }\n\n  public addIframe() {\n    const iframeHTML = `\n      <iframe \n        width=\"560\" \n        height=\"315\" \n        frameborder=\"0\" \n        loading=\"lazy\"\n        allow=\"accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture\" allowfullscreen\n        src=\"${this.src}\">\n      </iframe>`;\n\n    this.instance.insertAdjacentHTML('beforeend', iframeHTML);\n  }\n}\n\nclass Youtube implements ControllerInterface {\n  public preconnected: boolean;\n  private src: Maybe<string>;\n  private instance: LiteIframe;\n  private posterUrl: string;\n\n  public constructor(instance: LiteIframe, src: string) {\n    this.preconnected = false;\n\n    this.instance = instance;\n    this.src = src;\n\n    this.warmUp = this.warmUp.bind(this);\n    this.addIframe = this.addIframe.bind(this);\n\n    this.posterUrl = `https://i.ytimg.com/vi/${this.videoId}/hqdefault.jpg`;\n    addPrefetch('preload', this.posterUrl, 'image');\n  }\n\n  public connectedCallback() {\n    this.instance.style.backgroundImage = `url(\"${this.posterUrl}\")`;\n\n    const playBtn = document.createElement('div');\n    playBtn.classList.add('lty-playbtn');\n    this.instance.append(playBtn);\n\n    this.instance.addEventListener('pointerover', this.warmUp, {\n      once: true,\n    });\n\n    this.instance.addEventListener('click', () => this.addIframe());\n  }\n\n  public warmUp() {\n    addPrefetch('preconnect', 'https://www.youtube-nocookie.com');\n    addPrefetch('preconnect', 'https://www.google.com');\n  }\n\n  public addIframe() {\n    const iframeHTML = `\n      <iframe \n        width=\"560\" \n        height=\"315\" \n        frameborder=\"0\" \n        loading=\"lazy\"\n        allow=\"accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture\" allowfullscreen\n        src=\"${this.src}?autoplay=1\">\n      </iframe>`;\n\n    this.instance.insertAdjacentHTML('beforeend', iframeHTML);\n    this.instance.classList.add('lyt-activated');\n  }\n\n  private get videoId() {\n    if (this.src) {\n      let youtTubeIDRegex = /^.*(?:(?:youtu\\.be\\/|v\\/|vi\\/|u\\/\\w\\/|embed\\/)|(?:(?:watch)?\\?v(?:i)?=|\\&v(?:i)?=))([^#\\&\\?]*).*/;\n      let matchers = this.src.match(youtTubeIDRegex);\n      return matchers && matchers[1] ? matchers[1] : null;\n    }\n\n    return null;\n  }\n}\n\nconst adapters: Adapters = {\n  youtube: Youtube,\n  unknown: Unknown,\n};\n\nclass LiteIframe extends HTMLElement {\n  private controller: Adapter;\n  constructor() {\n    super();\n\n    let src = this.getAttribute('src');\n    let type = this.getAttribute('type') || 'unknown';\n    let adapter = adapters[type as AdapterKeys];\n\n    this.controller = new adapter(this, src || '');\n  }\n\n  connectedCallback() {\n    this.controller.connectedCallback();\n  }\n\n  public warmConnections() {\n    if (this.controller.preconnected) return;\n\n    this.controller.warmUp();\n    this.controller.preconnected = true;\n  }\n}\n\ncustomElements.define('lite-iframe', LiteIframe);\n"],"names":["addPrefetch","kind","url","as","linkElem","document","createElement","rel","href","crossOrigin","head","append","Unknown","instance","src","preconnected","warmUp","bind","addIframe","handleIntersection","window","io","IntersectionObserver","handleIframe","connectedCallback","observe","data","isIntersecting","cleanup","disconnect","iframeHTML","insertAdjacentHTML","Youtube","posterUrl","videoId","style","backgroundImage","playBtn","classList","add","addEventListener","once","youtTubeIDRegex","matchers","match","adapters","youtube","unknown","LiteIframe","getAttribute","type","adapter","controller","warmConnections","HTMLElement","customElements","define"],"mappings":"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"}